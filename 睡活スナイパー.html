<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éù„Ç±„Çπ„É™ Áù°Ê¥ª„Çπ„Éä„Ç§„Éë„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 12px;
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            }
        }

        @media (max-width: 480px) {
            .container {
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.12);
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.85;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        @media (max-width: 1024px) {
            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 26px;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 18px 12px;
            }

            .header h1 {
                font-size: 22px;
                margin-bottom: 6px;
            }

            .header p {
                font-size: 11px;
                margin-bottom: 6px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 20px;
                margin-bottom: 5px;
            }

            .header p {
                font-size: 10px;
                margin-bottom: 4px;
            }
        }

        .content {
            padding: 20px;
        }

        @media (max-width: 1024px) {
            .content {
                padding: 18px;
            }
        }

        @media (max-width: 768px) {
            .content {
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            .content {
                padding: 8px;
            }
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            font-weight: 700;
        }

        @media (max-width: 1024px) {
            .section {
                margin-bottom: 25px;
            }

            .section h2 {
                font-size: 16px;
                margin-bottom: 12px;
                border-bottom: 2px solid #667eea;
                padding-bottom: 8px;
            }
        }

        @media (max-width: 768px) {
            .section {
                margin-bottom: 20px;
            }

            .section h2 {
                font-size: 15px;
                margin-bottom: 10px;
                padding-bottom: 7px;
            }
        }

        @media (max-width: 480px) {
            .section {
                margin-bottom: 18px;
            }

            .section h2 {
                font-size: 14px;
                margin-bottom: 10px;
                border-bottom: 2px solid #667eea;
                padding-bottom: 6px;
            }
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
        }

        .input-group input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
            width: 100%;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        /* „Çª„ÇØ„Ç∑„Éß„É≥1Áî®„ÅÆÁâπÂà•„Å™„Çπ„Çø„Ç§„É´ */
        .section:first-of-type .input-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .section:first-of-type .input-group {
            display: flex;
            flex-direction: column;
        }

        .section:first-of-type .input-group label {
            text-align: center;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .input-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }

            .input-group input {
                padding: 8px;
                font-size: 12px;
            }

            .input-group label {
                font-size: 10px;
                margin-bottom: 3px;
            }

            .section:first-of-type .input-group label {
                font-size: 11px;
                margin-bottom: 5px;
            }
        }

        @media (max-width: 480px) {
            .input-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 4px;
            }

            .input-group input {
                padding: 6px 4px;
                font-size: 11px;
                border: 2px solid #ddd;
            }

            .input-group label {
                font-size: 9px;
                margin-bottom: 2px;
                font-weight: 700;
            }

            .section:first-of-type .input-group label {
                font-size: 10px;
                margin-bottom: 4px;
                text-align: center;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
        }

        .input-group input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
            width: 100%;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 768px) {
            .input-group input {
                padding: 8px;
                font-size: 12px;
            }

            .input-group label {
                font-size: 10px;
                margin-bottom: 3px;
            }
        }

        @media (max-width: 480px) {
            .input-group input {
                padding: 6px 4px;
                font-size: 11px;
                border: 2px solid #ddd;
                width: 100%;
            }

            .input-group label {
                font-size: 9px;
                margin-bottom: 2px;
                font-weight: 700;
            }
        }

        /* „Çª„ÇØ„Ç∑„Éß„É≥1„ÅÆ„Ç´„É©„Éº„Éê„É™„Ç®„Éº„Ç∑„Éß„É≥ */
        .input-group.utouto input {
            border-color: #FFD700;
            background-color: #fffcf0;
        }

        .input-group.suyasuya input {
            border-color: #87CEEB;
            background-color: #f0faff;
        }

        .input-group.gussuri input {
            border-color: #1E90FF;
            background-color: #f0f7ff;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin: 15px 0;
            flex-wrap: wrap;
            align-items: center;
        }

        /* „Çª„ÇØ„Ç∑„Éß„É≥1„ÅÆ„Éú„Çø„É≥„Ç∞„É´„Éº„Éó„ÇíÊ®™‰∏¶„Å≥„Å´ */
        .section:first-of-type .button-group {
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: center;
            gap: 10px;
        }

        @media (max-width: 480px) {
            .button-group {
                gap: 6px;
            }

            .section:first-of-type .button-group {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 10px;
            }
        }

        .today-date {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            padding: 10px 12px;
            background: #f5f5f5;
            border-radius: 5px;
            min-width: 40px;
            text-align: center;
        }

        @media (max-width: 480px) {
            .today-date {
                font-size: 11px;
                padding: 8px 10px;
                min-width: 35px;
            }

            .section:first-of-type button {
                flex: 1;
                min-width: 200px;
            }
        }

        button {
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 600;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }

        @media (max-width: 480px) {
            button {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 100px;
            }

            .input-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .button-group {
                gap: 6px;
            }

            .today-date {
                font-size: 11px;
                min-width: 35px;
                padding: 8px 5px;
            }

            .section h2 {
                font-size: 15px;
                margin-bottom: 10px;
            }

            .header h1 {
                font-size: 20px;
            }

            .content {
                padding: 12px;
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .btn-info {
            background: #2196F3;
            color: white;
        }

        .btn-info:hover {
            background: #0b7dda;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin: 12px 0;
            border-radius: 5px;
            font-size: 12px;
            color: #1565c0;
            line-height: 1.5;
        }

        .history-input-container {
            background: #f9f9f9;
            padding: 0;
            border-radius: 8px;
            margin-bottom: 12px;
            max-height: 600px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        @media (max-width: 768px) {
            .history-input-container {
                max-height: 500px;
                overflow-x: hidden;
            }
        }

        @media (max-width: 480px) {
            .history-input-container {
                max-height: 400px;
                overflow-x: hidden;
            }
        }

        .history-input-row {
            display: flex;
            flex-wrap: nowrap;
            gap: 10px;
            padding: 12px;
            background: white;
            border-bottom: 1px solid #eee;
            border-radius: 5px;
            border-left: 4px solid #667eea;
            align-items: flex-end;
            margin-bottom: 8px;
        }

        .history-input-field {
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .history-input-field label {
            font-size: 10px;
            font-weight: 700;
            color: #555;
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .history-input-field input {
            padding: 8px 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1;
            height: auto;
        }

        .history-input-field select {
            padding: 8px 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1;
            height: auto;
        }

        /* Êó•‰ªòÂÖ•ÂäõÊ¨Ñ„ÅÆ„ÅøÂπÖ„ÇíÂà∂Èôê */
        .history-date-input {
            max-width: 50px;
        }

        @media (min-width: 1025px) {
            .history-input-row {
                flex-wrap: nowrap;
                gap: 12px;
                padding: 12px;
            }

            .history-input-field {
                flex: 0 0 auto;
            }

            .history-input-field:nth-child(2) {
                min-width: 90px;
            }

            .history-input-field:nth-child(3),
            .history-input-field:nth-child(4),
            .history-input-field:nth-child(5) {
                min-width: 150px;
            }

            .history-input-field label {
                font-size: 10px;
            }

            .history-input-field input {
                padding: 8px 10px;
                font-size: 14px;
            }

            .history-input-field select {
                padding: 8px 10px;
                font-size: 14px;
            }

            .history-date-input {
                max-width: 120px;
            }
        }

        @media (max-width: 1024px) {
            .history-input-row {
                gap: 8px;
                padding: 10px;
            }

            .history-input-field {
                flex: 0 0 auto;
            }

            .history-input-field:nth-child(2) {
                min-width: 75px;
            }

            .history-input-field:nth-child(3),
            .history-input-field:nth-child(4),
            .history-input-field:nth-child(5) {
                min-width: 125px;
            }

            .history-input-field label {
                font-size: 9px;
            }

            .history-input-field input {
                padding: 7px 9px;
                font-size: 12px;
            }

            .history-input-field select {
                padding: 7px 9px;
                font-size: 12px;
            }

            .history-date-input {
                max-width: 100px;
            }
        }

        @media (max-width: 768px) {
            .history-input-row {
                gap: 4px;
                padding: 6px;
            }

            .history-input-field {
                flex: 0 0 auto;
            }

            .history-input-field:nth-child(2) {
                min-width: 55px;
            }

            .history-input-field:nth-child(3),
            .history-input-field:nth-child(4),
            .history-input-field:nth-child(5) {
                min-width: 100px;
            }

            .history-input-field label {
                font-size: 8px;
                margin-bottom: 1px;
            }

            .history-input-field input {
                padding: 4px 5px;
                font-size: 10px;
            }

            .history-input-field select {
                padding: 4px 5px;
                font-size: 10px;
            }

            .history-date-input {
                max-width: 84px;
            }
        }

        @media (max-width: 480px) {
            .history-input-row {
                gap: 2px;
                padding: 3px;
            }

            .history-input-field {
                flex: 0 0 auto;
            }

            .history-input-field:nth-child(2) {
                min-width: 50px;
            }

            .history-input-field:nth-child(3),
            .history-input-field:nth-child(4),
            .history-input-field:nth-child(5) {
                min-width: 50px;
            }

            .history-input-field label {
                font-size: 5px;
                margin-bottom: 1px;
                line-height: 1;
            }

            /* ÂàÜÂâ≤Ê¨Ñ„ÅÆ„É©„Éô„É´„Çí5px */
            .history-input-field:nth-child(2) label {
                font-size: 5px;
            }

            .history-input-field input {
                padding: 2px 1px;
                font-size: 7px;
                border: 1px solid #ddd;
            }

            .history-input-field select {
                padding: 2px 1px;
                font-size: 6px;
                border: 1px solid #ddd;
            }

            /* ÂàÜÂâ≤„Çª„É¨„ÇØ„Éà„Çí7px */
            .history-input-field:nth-child(2) select {
                font-size: 7px;
            }

            .history-date-input {
                max-width: 60px;
            }
        }

        .history-input-row:last-child {
            border-bottom: none;
        }

        .history-input-field {
            display: flex;
            flex-direction: column;
        }

        .history-input-field label {
            font-size: 10px;
            font-weight: 700;
            color: #555;
            margin-bottom: 2px;
            white-space: nowrap;
            line-height: 1.2;
        }

        @media (max-width: 600px) {
            .history-input-field label {
                font-size: 7px;
                margin-bottom: 1px;
                font-weight: 700;
                color: #666;
            }
        }

        @media (max-width: 480px) {
            .history-input-field label {
                font-size: 7px;
                margin-bottom: 1px;
                font-weight: 700;
                color: #666;
            }
        }

        .history-input-field input {
            padding: 8px 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1;
            height: auto;
        }

        @media (max-width: 1024px) {
            .history-input-field label {
                font-size: 9px;
                margin-bottom: 2px;
            }

            .history-input-field input {
                padding: 7px 9px;
                font-size: 13px;
                line-height: 1;
                height: auto;
            }

            .history-input-field select {
                padding: 7px 9px;
                font-size: 13px;
                line-height: 1;
                height: auto;
            }
        }

        @media (max-width: 768px) {
            .history-input-field label {
                font-size: 8px;
                margin-bottom: 1px;
            }

            .history-input-field input {
                padding: 6px 8px;
                font-size: 12px;
                line-height: 1;
                height: auto;
            }

            .history-input-field select {
                padding: 6px 8px;
                font-size: 12px;
                line-height: 1;
                height: auto;
            }
        }

        @media (max-width: 480px) {
            .history-input-field label {
                font-size: 7px;
                margin-bottom: 1px;
                font-weight: 700;
            }

            .history-input-field input {
                padding: 5px 4px;
                font-size: 13px;
                border: 1px solid #ddd;
                width: 100%;
                line-height: 1;
                height: auto;
            }

            .history-input-field select {
                padding: 5px 4px;
                font-size: 12px;
                border: 1px solid #9b97cc;
                width: 100%;
                line-height: 1;
                height: auto;
            }
        }

        .history-input-field select {
            padding: 8px 10px;
            border: 2px solid #9b97cc;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: #f3f0f9;
            cursor: pointer;
            color: #333;
            font-weight: 600;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: auto;
            line-height: 1;
        }

        .history-input-field select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 3px rgba(102, 126, 234, 0.3);
        }

        /* „Çª„ÇØ„Ç∑„Éß„É≥2„ÅÆ„Ç´„É©„Éº„Éê„É™„Ç®„Éº„Ç∑„Éß„É≥ */
        .history-input-field .history-date-input {
            border-color: #ddd;
            background-color: #ffffff;
        }

        .history-input-field .history-split {
            font-size: 13px;
        }

        @media (max-width: 480px) {
            .history-input-field .history-split {
                font-size: 12px;
            }
        }

        .history-input-field .history-utouto {
            border-color: #FFD700;
            background-color: #fffcf0;
        }

        .history-input-field .history-suyasuya {
            border-color: #87CEEB;
            background-color: #f0faff;
        }

        .history-input-field .history-gussuri {
            border-color: #1E90FF;
            background-color: #f0f7ff;
        }

        .history-date-display {
            padding: 4px 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 10px;
            background: #f9f9f9;
            font-weight: 600;
            color: #333;
        }

        /* „Éò„ÉÉ„ÉÄ„ÉºÂâäÈô§ */
        .history-grid-header {
            display: none;
        }

        .backup-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }

        .backup-modal.active {
            display: flex;
        }

        .backup-modal-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .backup-modal-content h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .close-button:hover {
            color: #333;
        }

        .backup-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .backup-section h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .backup-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 10px;
        }

        .backup-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        .close-modal {
            margin-top: 15px;
        }

        .threshold-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .segment-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            background: #f0f0f0;
            padding: 4px;
        }

        .segment-btn {
            flex: 1;
            padding: 12px 10px;
            border: none;
            background: transparent;
            color: #666;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 6px;
        }

        .segment-btn.active {
            background: white;
            color: #333;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .segment-btn.utouto.active {
            border-bottom: 3px solid #FFD700;
            color: #FFD700;
        }

        .segment-btn.suyasuya.active {
            border-bottom: 3px solid #87CEEB;
            color: #87CEEB;
        }

        .segment-btn.gussuri.active {
            border-bottom: 3px solid #1E90FF;
            color: #1E90FF;
        }

        /* „Çπ„Éû„ÉõÂØæÂøú */
        @media (max-width: 768px) {
            .segment-btn {
                padding: 8px 6px;
                font-size: 11px;
                min-width: 60px;
            }

            .segment-buttons {
                gap: 4px;
                padding: 2px;
            }
        }

        @media (max-width: 480px) {
            .segment-btn {
                padding: 6px 4px;
                font-size: 10px;
                min-width: 50px;
            }

            .segment-buttons {
                gap: 2px;
                padding: 2px;
            }
        }

        .threshold-display-container {
            display: none;
        }

        .threshold-display-container.active {
            display: block;
        }

        .threshold-box {
            background: white;
            border: 3px solid;
            padding: 20px 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 200px;
        }

        .threshold-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .threshold-box.utouto {
            border-color: #FFD700;
        }

        .threshold-box.utouto.active {
            background: #fffacd;
        }

        .threshold-box.suyasuya {
            border-color: #87CEEB;
        }

        .threshold-box.suyasuya.active {
            background: #e0f7ff;
        }

        .threshold-box.gussuri {
            border-color: #1E90FF;
        }

        .threshold-box.gussuri.active {
            background: #e6f2ff;
        }

        .threshold-box h3 {
            font-size: 13px;
            margin-bottom: 12px;
            color: #333;
            text-align: center;
            font-weight: 700;
        }

        .threshold-display {
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .time-display {
            margin: 12px 0;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 12px;
        }

        .time-unit-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .time-number {
            font-size: 52px;
            font-weight: bold;
            color: #ff6b6b;
            line-height: 1;
        }

        .time-unit {
            font-size: 10px;
            color: #ff6b6b;
            font-weight: 700;
            margin-top: 4px;
            text-transform: uppercase;
        }

        @media (max-width: 480px) {
            .threshold-box {
                min-height: 160px;
                padding: 15px 12px;
            }

            .threshold-box h3 {
                font-size: 12px;
                margin-bottom: 10px;
            }

            .time-display {
                margin: 8px 0;
                gap: 10px;
            }

            .time-number {
                font-size: 40px;
            }

            .time-unit {
                font-size: 9px;
                margin-top: 2px;
            }

            .threshold-percent-small {
                font-size: 13px;
            }

            .threshold-avg-text {
                font-size: 9px;
            }

            .time-above {
                font-size: 14px;
            }
        }

        .threshold-percent-small {
            font-size: 14px;
            color: #667eea;
            font-weight: 700;
            margin: 6px 0;
        }

        .threshold-avg-text {
            font-size: 10px;
            color: #999;
            margin-top: 4px;
        }

        .time-above {
            font-size: 16px;
            color: #ff6b6b;
            font-weight: 700;
        }

        /* „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥ÂØæÂøú */
        @media (min-width: 600px) {
            body {
                padding: 15px;
            }

            .header {
                padding: 25px 20px;
            }

            .header h1 {
                font-size: 26px;
                margin-bottom: 10px;
            }

            .header p {
                font-size: 11px;
            }

            .content {
                padding: 20px;
            }

            .section h2 {
                font-size: 17px;
                margin-bottom: 15px;
                padding-bottom: 10px;
            }

            .button-group {
                gap: 10px;
            }

            button {
                padding: 12px 20px;
                font-size: 14px;
                flex: none;
                min-width: auto;
            }

            .today-date {
                font-size: 13px;
                min-width: 90px;
            }

            .history-grid-header {
                grid-template-columns: 0.5fr 1fr 1fr 1fr;
                font-size: 12px;
            }

            .history-input-row {
                grid-template-columns: 0.5fr 1fr 1fr 1fr;
                padding: 10px;
            }

            .threshold-box {
                min-height: 280px;
            }

            .threshold-box h3 {
                font-size: 15px;
            }

            .time-number {
                font-size: 56px;
            }

            .time-unit {
                font-size: 11px;
            }

            .threshold-percent-small {
                font-size: 16px;
            }

            .threshold-avg-text {
                font-size: 11px;
            }
        }

        @media (min-width: 1024px) {
            body {
                padding: 20px;
            }

            .container {
                max-width: 1200px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 28px;
            }

            .content {
                padding: 30px;
            }

            .section h2 {
                font-size: 18px;
            }

            button {
                padding: 12px 24px;
                font-size: 14px;
            }

            .today-date {
                font-size: 14px;
                min-width: 100px;
            }

            .threshold-box {
                min-height: 320px;
            }

            .threshold-box h3 {
                font-size: 16px;
            }

            .time-number {
                font-size: 64px;
            }

            .time-unit {
                font-size: 12px;
            }

            .threshold-percent-small {
                font-size: 18px;
            }

            .threshold-avg-text {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <p>„ÅÜ„Å®„ÅÜ„Å®„Éª„Åô„ÇÑ„Åô„ÇÑ„Éª„Åê„Å£„Åô„Çä„ÄÄ„ÇíÁãô„ÅÑÊíÉ„Å°</p>
            <h1>üåô „Éù„Ç±„Çπ„É™ Áù°Ê¥ª„Çπ„Éä„Ç§„Éë„Éº</h1>
        </div>

        <div class="content">
            <!-- 1. ‰ªäÊó•„ÅÆ„Éá„Éº„ÇøÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section">
                <h2>üìÖ 1. ‰ªäÊó•„ÅÆÁù°Áú†„Éá„Éº„Çø„ÇíÂÖ•Âäõ</h2>
                <div class="info-box">
                    üí° ‰ªäÊó•Ë®àÊ∏¨„Åó„ÅüÁù°Áú†„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ‰øùÂ≠ò„Åï„Çå„Çã„Å®ÈÅéÂéª30Âõû„ÅÆ„Éá„Éº„Çø„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô„ÄÇ
                </div>

                <div class="input-grid">
                    <div class="input-group utouto">
                        <label>„ÅÜ„Å®„ÅÜ„Å® %</label>
                        <input type="number" id="todayUtouto" min="0" max="100" value="0" placeholder="0">
                    </div>
                    <div class="input-group suyasuya">
                        <label>„Åô„ÇÑ„Åô„ÇÑ %</label>
                        <input type="number" id="todaySuyasuya" min="0" max="100" value="0" placeholder="0">
                    </div>
                    <div class="input-group gussuri">
                        <label>„Åê„Å£„Åô„Çä %</label>
                        <input type="number" id="todayGussuri" min="0" max="100" value="0" placeholder="0">
                    </div>
                </div>

                <div class="button-group">
                    <div class="today-date" id="todayDateDisplay">-</div>
                    <button class="btn-success" onclick="saveTodayData()">‚úì ‰ªäÊó•„ÅÆ„Éá„Éº„Çø„Çí‰øùÂ≠ò</button>
                </div>
            </div>

            <!-- 2. ÈÅéÂéª30Âõû„ÅÆ„Éá„Éº„ÇøÊâãÂãïÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section">
                <h2>üìà 2. ÈÅéÂéª30Âõû„ÅÆ„Éá„Éº„Çø„ÇíÊâãÂãïÂÖ•Âäõ</h2>

                <div class="history-input-container" id="historyInputContainer"></div>

                <div class="button-group">
                    <button class="btn-success" onclick="openBackupModal()">üíæ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó</button>
                </div>
            </div>

            <!-- 3. ÁõÆÊ®ô„Çø„Ç§„ÉóÂà•„ÅÆÈñæÂÄ§Ë®àÁÆó„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section">
                <h2>3. Áãô„ÅÜ„Åü„ÇÅ„ÅÆÊúÄÂ∞èÊôÇÈñì</h2>
                <div class="info-box">
                    üí° Áù°Áú†„Çø„Ç§„ÉóÔºù(ÂΩìÊó•„ÅÆÂêÑÁù°Áú†„Çø„Ç§„Éó„ÅÆÔºÖ)„Éº(ÈÅéÂéª30Âõû„ÅÆÂπ≥ÂùáÔºÖ) „Åå‰∏ÄÁï™Â§ß„Åç„ÅÑÁù°Áú†„Çø„Ç§„Éó
                </div>

                <!-- Áù°Áú†ÊôÇÈñìË®≠ÂÆö -->
                <div style="margin-bottom: 15px; padding: 12px; border-left: 4px solid #667eea; border-radius: 5px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                    <label style="font-size: 12px; font-weight: 600; color: #333;">Áù°Áú†ÊôÇÈñìÔºö</label>
                    <input type="number" id="maxSleepTime" min="1" max="24" step="0.5" value="8.5" placeholder="8.5" style="width: 70px; padding: 8px; border: 2px solid #667eea; border-radius: 4px; font-size: 14px;">
                    <span style="font-size: 12px; color: #666;">ÊôÇÈñì</span>
                    <button style="padding: 6px 12px; font-size: 12px; background: #f0f0f0; border: none; border-radius: 4px; cursor: pointer; color: #666; font-weight: 600;" onclick="resetSleepTime()">8.5„Å´Êàª„Åô</button>
                </div>

                <div id="thresholdContainer">
                    <!-- „Çª„Ç∞„É°„É≥„ÉàÈÅ∏Êäû„Éú„Çø„É≥ -->
                    <div class="segment-buttons">
                        <button class="segment-btn utouto active" onclick="switchThresholdDisplay('utouto')">„ÅÜ„Å®„ÅÜ„Å®</button>
                        <button class="segment-btn suyasuya" onclick="switchThresholdDisplay('suyasuya')">„Åô„ÇÑ„Åô„ÇÑ</button>
                        <button class="segment-btn gussuri" onclick="switchThresholdDisplay('gussuri')">„Åê„Å£„Åô„Çä</button>
                    </div>

                    <!-- „ÅÜ„Å®„ÅÜ„Å®Ë°®Á§∫ -->
                    <div class="threshold-display-container active" id="containerUtouto">
                        <div class="threshold-box utouto">
                            <h3>Áãô„ÅÑÔºö„ÅÜ„Å®„ÅÜ„Å®<br><span style="font-size: 11px; color: #666; font-weight: normal;">„ÅÜ„Å®„ÅÜ„Å®ÊôÇÈñì„Çí„ÄÅ</span></h3>
                            <div class="threshold-display" id="displayUtouto"></div>
                        </div>
                    </div>

                    <!-- „Åô„ÇÑ„Åô„ÇÑË°®Á§∫ -->
                    <div class="threshold-display-container" id="containerSuyasuya">
                        <div class="threshold-box suyasuya">
                            <h3>Áãô„ÅÑÔºö„Åô„ÇÑ„Åô„ÇÑ<br><span style="font-size: 11px; color: #666; font-weight: normal;">„Åô„ÇÑ„Åô„ÇÑÊôÇÈñì„Çí„ÄÅ</span></h3>
                            <div class="threshold-display" id="displaySuyasuya"></div>
                        </div>
                    </div>

                    <!-- „Åê„Å£„Åô„ÇäË°®Á§∫ -->
                    <div class="threshold-display-container" id="containerGussuri">
                        <div class="threshold-box gussuri">
                            <h3>Áãô„ÅÑÔºö„Åê„Å£„Åô„Çä<br><span style="font-size: 11px; color: #666; font-weight: normal;">„Åê„Å£„Åô„ÇäÊôÇÈñì„Çí„ÄÅ</span></h3>
                            <div class="threshold-display" id="displayGussuri"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div style="text-align: center; padding: 20px; font-size: 10px; color: #999; border-top: 1px solid #eee;">
        ‚ÄªÊú¨„ÉÑ„Éº„É´„ÅØ„Éù„Ç±„Çπ„É™„ÅÆ„Éï„Ç°„É≥„Å´„Çà„ÇãÈùûÂÖ¨Âºè„ÉÑ„Éº„É´„Åß„ÅÇ„Çä„ÄÅË£Ω‰ΩúËÄÖ„ÅØ‰∏ÄÂàá„ÅÆË≤¨‰ªª„ÇíË≤†„ÅÑ„Åæ„Åõ„Çì„ÄÇ
    </div>

    <!-- „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„É¢„Éº„ÉÄ„É´ -->
    <div class="backup-modal" id="backupModal">
        <div class="backup-modal-content">
            <h3>
                üíæ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÁÆ°ÁêÜ
                <button class="close-button" onclick="closeBackupModal()">√ó</button>
            </h3>

            <!-- „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó‰ΩúÊàê -->
            <div class="backup-section">
                <h4>üìù „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÁî®„ÉÜ„Ç≠„Çπ„Éà„Çí‰ΩúÊàê</h4>
                <p style="font-size: 11px; color: #666; margin-bottom: 10px;">
                    ÁèæÂú®„ÅÆ„Éá„Éº„Çø„Çí„ÉÜ„Ç≠„Çπ„ÉàÂΩ¢Âºè„Åß‰øùÂ≠ò„Åó„Åæ„Åô„ÄÇ„Åì„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Çí„Ç≥„Éî„Éº„Åó„Å¶ÂÆâÂÖ®„Å´‰øùÁÆ°„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                </p>
                <button class="btn-success" style="width: 100%;" onclick="createBackup()">üíæ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Çí‰ΩúÊàê</button>
                <textarea class="backup-textarea" id="backupText" readonly placeholder="„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÜ„Ç≠„Çπ„Éà„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô"></textarea>
                <button class="btn-primary" style="width: 100%;" onclick="copyBackupText()">üìã „ÉÜ„Ç≠„Çπ„Éà„Çí„Ç≥„Éî„Éº</button>
            </div>

            <!-- Âæ©Êóß -->
            <div class="backup-section">
                <h4>üìÇ „ÉÜ„Ç≠„Çπ„Éà„Åã„ÇâÂæ©Êóß</h4>
                <p style="font-size: 11px; color: #666; margin-bottom: 10px;">
                    ‰øùÂ≠ò„Åó„Å¶„ÅÑ„Åü„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÜ„Ç≠„Çπ„Éà„ÇíË≤º„Çä‰ªò„Åë„Å¶„ÄÅ„Éá„Éº„Çø„ÇíÂæ©Êóß„Åó„Åæ„Åô„ÄÇ
                </p>
                <textarea class="backup-textarea" id="restoreText" placeholder="„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÜ„Ç≠„Çπ„Éà„ÇíË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                <button class="btn-primary" style="width: 100%;" onclick="restoreBackup()">Âæ©Êóß„Åô„Çã</button>
            </div>

            <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ -->
            <button class="btn-secondary close-modal" style="width: 100%;" onclick="closeBackupModal()">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <script>
        let historyData = [];
        let selectedType = 'utouto'; // „Éá„Éï„Ç©„É´„Éà„ÅØ„ÅÜ„Å®„ÅÜ„Å®
        let MAX_SLEEP_TIME = 8.5; // 8.5ÊôÇÈñì„Çí100%„Å®„Åô„ÇãÔºà„Éá„Éï„Ç©„É´„ÉàÔºâ

        // LocalStorage„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
        window.addEventListener('DOMContentLoaded', function() {
            updateTodayDate();
            loadHistoryFromStorage();
            initializeHistoryRows();
            
            // MAXÊôÇÈñì„ÅÆÂ§âÊõ¥„Ç§„Éô„É≥„Éà
            document.getElementById('maxSleepTime').addEventListener('change', function() {
                MAX_SLEEP_TIME = parseFloat(this.value) || 8.5;
                updateAllThresholds();
            });
            
            // „Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÊõ¥Êñ∞
            if (historyData.length === 0) {
                updateHistoryData();
            }
            
            updateAllThresholds();
            // „Éá„Éï„Ç©„É´„Éà„Åß„ÅÜ„Å®„ÅÜ„Å®„ÇíÈÅ∏Êäû
            selectThresholdType('utouto');
            
            // „É¢„Éº„ÉÄ„É´„ÅÆÂ§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Èñâ„Åò„Çã
            const backupModal = document.getElementById('backupModal');
            if (backupModal) {
                backupModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeBackupModal();
                    }
                });
            }
        });

        function updateTodayDate() {
            const today = new Date();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            const dateStr = `Êó•‰ªòÔºö${month}/${day}`;
            document.getElementById('todayDateDisplay').textContent = dateStr;
        }

        function resetSleepTime() {
            document.getElementById('maxSleepTime').value = 8.5;
            MAX_SLEEP_TIME = 8.5;
            updateAllThresholds();
        }

        // adjustHistoryGridWidthÈñ¢Êï∞„ÅØ‰∏çË¶Å„Å´„Å™„Å£„Åü„ÅÆ„ÅßÂâäÈô§Ôºà2Ë°åÊßãÊàê„Å´Â§âÊõ¥Ôºâ

        function generateDateStrings() {
            const dates = [];
            const today = new Date();

            // ‰ªäÊó•„Åã„Çâ30Êó•Ââç„Åæ„Åß„ÇíÈÄÜÈ†Ü„ÅßÁîüÊàêÔºà1Áï™ÁõÆ„Åå‰ªäÊó•Ôºâ
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                dates.push(`${month}/${day}`);
            }

            return dates;
        }

        function percentToTime(percent) {
            const hours = (percent / 100) * MAX_SLEEP_TIME;
            const h = Math.floor(hours);
            const m = Math.round((hours - h) * 60);
            return { h, m, hours };
        }

        function initializeHistoryRows() {
            const container = document.getElementById('historyInputContainer');
            container.innerHTML = '';

            const dates = generateDateStrings();

            // 30Ë°å‰ΩúÊàê
            for (let i = 0; i < 30; i++) {
                // ÊúÄÂàù„ÅÆË°åÔºài=0„ÄÅ„Å§„Åæ„Çä‰ªäÊó•Ôºâ„Å´„ÅØ„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË®≠ÂÆö
                let data;
                if (i === 0 && historyData.length === 0) {
                    data = { utouto: 40, suyasuya: 40, gussuri: 20, split: '‰∏ÄÊã¨' };
                } else {
                    data = historyData[i] || { utouto: '', suyasuya: '', gussuri: '', split: '‰∏ÄÊã¨' };
                }
                
                const row = document.createElement('div');
                row.className = 'history-input-row';
                
                row.innerHTML = `
                    <div class="history-input-field">
                        <label>Êó•‰ªò${i + 1}</label>
                        <input type="text" class="history-date-input" value="${dates[i]}" placeholder="M/D" data-index="${i}">
                    </div>
                    <div class="history-input-field">
                        <label>ÂàÜÂâ≤</label>
                        <select class="history-split" data-index="${i}">
                            <option value="‰∏ÄÊã¨" ${data.split === '‰∏ÄÊã¨' ? 'selected' : ''}>‰∏ÄÊã¨</option>
                            <option value="ÂàÜÂâ≤‚ë†" ${data.split === 'ÂàÜÂâ≤‚ë†' ? 'selected' : ''}>ÂàÜÂâ≤‚ë†</option>
                            <option value="ÂàÜÂâ≤‚ë°" ${data.split === 'ÂàÜÂâ≤‚ë°' ? 'selected' : ''}>ÂàÜÂâ≤‚ë°</option>
                        </select>
                    </div>
                    <div class="history-input-field">
                        <label>„ÅÜ„Å®„ÅÜ„Å® %</label>
                        <input type="number" class="history-utouto" min="0" max="100" placeholder="0" value="${data.utouto}" data-index="${i}">
                    </div>
                    <div class="history-input-field">
                        <label>„Åô„ÇÑ„Åô„ÇÑ %</label>
                        <input type="number" class="history-suyasuya" min="0" max="100" placeholder="0" value="${data.suyasuya}" data-index="${i}">
                    </div>
                    <div class="history-input-field">
                        <label>„Åê„Å£„Åô„Çä %</label>
                        <input type="number" class="history-gussuri" min="0" max="100" placeholder="0" value="${data.gussuri}" data-index="${i}">
                    </div>
                `;
                container.appendChild(row);
            }

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºËøΩÂä†
            document.querySelectorAll('.history-utouto, .history-suyasuya, .history-gussuri, .history-split').forEach(input => {
                input.addEventListener('change', updateHistoryData);
                input.addEventListener('input', updateHistoryData);
            });
        }

        function updateHistoryData() {
            const dates = generateDateStrings();
            historyData = [];
            let hasData = false;

            document.querySelectorAll('.history-utouto').forEach((utoutInput, index) => {
                const utouto = parseInt(utoutInput.value) || 0;
                const suyasuya = parseInt(document.querySelectorAll('.history-suyasuya')[index].value) || 0;
                const gussuri = parseInt(document.querySelectorAll('.history-gussuri')[index].value) || 0;
                const split = document.querySelectorAll('.history-split')[index] ? 
                    document.querySelectorAll('.history-split')[index].value : '‰∏ÄÊã¨';

                if (utouto > 0 || suyasuya > 0 || gussuri > 0) {
                    historyData.push({
                        date: dates[index],
                        utouto: utouto,
                        suyasuya: suyasuya,
                        gussuri: gussuri,
                        split: split
                    });
                    hasData = true;
                }
            });

            saveHistoryToStorage();
            if (hasData) {
                updateAllThresholds();
            }
        }

        function saveTodayData() {
            const u = parseFloat(document.getElementById('todayUtouto').value) || 0;
            const s = parseFloat(document.getElementById('todaySuyasuya').value) || 0;
            const g = parseFloat(document.getElementById('todayGussuri').value) || 0;

            if (u === 0 && s === 0 && g === 0) {
                alert('0‰ª•Â§ñ„ÅÆ„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            if (Math.abs((u + s + g) - 100) > 0.1) {
                const result = confirm('ÂêàË®à„Åå100%„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\nÂêàË®à: ' + (u + s + g).toFixed(1) + '%\n\n‰øùÂ≠ò„Åó„Åæ„Åô„ÅãÔºü');
                if (!result) return;
            }

            // ÊúÄÂàù„ÅÆË°å„Å´ÊåøÂÖ•
            if (document.querySelector('.history-utouto')) {
                document.querySelector('.history-utouto').value = u;
                document.querySelector('.history-suyasuya').value = s;
                document.querySelector('.history-gussuri').value = g;
            }

            updateHistoryData();

            // ÂÖ•Âäõ„Çí„ÇØ„É™„Ç¢
            document.getElementById('todayUtouto').value = '';
            document.getElementById('todaySuyasuya').value = '';
            document.getElementById('todayGussuri').value = '';

            alert('„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
        }

        function selectThresholdType(type) {
            selectedType = type;
            switchThresholdDisplay(type);
        }

        function switchThresholdDisplay(type) {
            // „Åô„Åπ„Å¶„ÅÆ„Çª„Ç∞„É°„É≥„Éà„Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÂâäÈô§
            document.querySelectorAll('.segment-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // „Åô„Åπ„Å¶„ÅÆ„Éá„Ç£„Çπ„Éó„É¨„Ç§„Ç≥„É≥„ÉÜ„Éä„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.threshold-display-container').forEach(container => {
                container.classList.remove('active');
            });

            // ÂØæÂøú„Åô„Çã„Éú„Çø„É≥„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´Ôºàtype„Åã„ÇâÔºâ
            const typeMap = { 'utouto': 'Utouto', 'suyasuya': 'Suyasuya', 'gussuri': 'Gussuri' };
            const buttons = document.querySelectorAll('.segment-btn');
            buttons.forEach(btn => {
                if (btn.textContent.includes(type === 'utouto' ? '„ÅÜ„Å®„ÅÜ„Å®' : type === 'suyasuya' ? '„Åô„ÇÑ„Åô„ÇÑ' : '„Åê„Å£„Åô„Çä')) {
                    btn.classList.add('active');
                }
            });

            // ÂØæÂøú„Åô„Çã„Ç≥„É≥„ÉÜ„Éä„ÇíË°®Á§∫
            document.getElementById(`container${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');

            selectedType = type;
        }

        // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÊ©üËÉΩ
        function openBackupModal() {
            document.getElementById('backupModal').classList.add('active');
        }

        function closeBackupModal() {
            document.getElementById('backupModal').classList.remove('active');
            document.getElementById('backupText').value = '';
            document.getElementById('restoreText').value = '';
        }

        function createBackup() {
            // ÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó
            const allData = [];
            const dateInputs = document.querySelectorAll('.history-date-input');
            const splitInputs = document.querySelectorAll('.history-split');
            const utouInput = document.querySelectorAll('.history-utouto');
            const suyasuyaInputs = document.querySelectorAll('.history-suyasuya');
            const gussiriInputs = document.querySelectorAll('.history-gussuri');

            for (let i = 0; i < 30; i++) {
                try {
                    const date = dateInputs[i] ? dateInputs[i].value : '';
                    const split = splitInputs[i] ? splitInputs[i].value : '‰∏ÄÊã¨';
                    const utouto = utouInput[i] ? (parseInt(utouInput[i].value) || 0) : 0;
                    const suyasuya = suyasuyaInputs[i] ? (parseInt(suyasuyaInputs[i].value) || 0) : 0;
                    const gussuri = gussiriInputs[i] ? (parseInt(gussiriInputs[i].value) || 0) : 0;
                    allData.push([date, split, utouto, suyasuya, gussuri]);
                } catch (e) {
                    console.error('Row ' + i + ' error:', e);
                    allData.push(['', '‰∏ÄÊã¨', 0, 0, 0]);
                }
            }

            try {
                // JSONÂΩ¢Âºè„Åß‰ΩúÊàê
                const backupData = JSON.stringify(allData);
                
                // UTF-8„ÇíBase64„Ç®„É≥„Ç≥„Éº„ÉâÔºàÊó•Êú¨Ë™ûÂØæÂøúÔºâ
                const utf8Data = unescape(encodeURIComponent(backupData));
                const encrypted = btoa(utf8Data);
                
                document.getElementById('backupText').value = encrypted;
                alert('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÜ„Ç≠„Çπ„Éà„Çí‰ΩúÊàê„Åó„Åæ„Åó„ÅüÔºÅ');
            } catch (e) {
                alert('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
                console.error('Backup error:', e);
            }
        }

        function copyBackupText() {
            const text = document.getElementById('backupText');
            if (!text.value) {
                alert('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÜ„Ç≠„Çπ„Éà„ÅåÁ©∫„Åß„Åô„ÄÇÂÖà„Å´„Äå„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Çí‰ΩúÊàê„Äç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            text.select();
            document.execCommand('copy');
            alert('„ÉÜ„Ç≠„Çπ„Éà„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ');
        }

        function restoreBackup() {
            const encryptedText = document.getElementById('restoreText').value.trim();
            
            if (!encryptedText) {
                alert('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÜ„Ç≠„Çπ„Éà„ÇíË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            try {
                // Base64„Éá„Ç≥„Éº„ÉâÔºàUTF-8ÂØæÂøúÔºâ
                const utf8Data = atob(encryptedText);
                const decrypted = decodeURIComponent(escape(utf8Data));
                const allData = JSON.parse(decrypted);

                if (!Array.isArray(allData) || allData.length !== 30) {
                    alert('ÁÑ°Âäπ„Å™„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÜ„Ç≠„Çπ„Éà„Åß„Åô„ÄÇ');
                    return;
                }

                // „Éá„Éº„ÇøÂèñÂæó
                const dateInputs = document.querySelectorAll('.history-date-input');
                const splitInputs = document.querySelectorAll('.history-split');
                const utouInputs = document.querySelectorAll('.history-utouto');
                const suyasuyaInputs = document.querySelectorAll('.history-suyasuya');
                const gussiriInputs = document.querySelectorAll('.history-gussuri');

                // „Éá„Éº„Çø„ÇíÂæ©Êóß
                for (let i = 0; i < 30; i++) {
                    const item = allData[i];
                    // Êñ∞ÂΩ¢ÂºèÔºö[date, split, utouto, suyasuya, gussuri]
                    // ÊóßÂΩ¢ÂºèÔºö[utouto, suyasuya, gussuri, split]
                    let date, split, u, s, g;
                    
                    if (item.length === 5) {
                        // Êñ∞ÂΩ¢Âºè
                        [date, split, u, s, g] = item;
                    } else {
                        // ÊóßÂΩ¢ÂºèÔºà‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÔºâ
                        [u, s, g, split] = item;
                        date = '';
                    }
                    
                    if (dateInputs[i]) {
                        dateInputs[i].value = date || '';
                    }
                    if (splitInputs[i]) {
                        splitInputs[i].value = split || '‰∏ÄÊã¨';
                    }
                    if (utouInputs[i]) {
                        utouInputs[i].value = u || '';
                    }
                    if (suyasuyaInputs[i]) {
                        suyasuyaInputs[i].value = s || '';
                    }
                    if (gussiriInputs[i]) {
                        gussiriInputs[i].value = g || '';
                    }
                }

                updateHistoryData();
                alert('„Éá„Éº„Çø„ÇíÂæ©Êóß„Åó„Åæ„Åó„ÅüÔºÅ');
                closeBackupModal();
            } catch (e) {
                alert('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÉÜ„Ç≠„Çπ„Éà„ÅÆÂæ©Êóß„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊ≠£„Åó„ÅÑ„ÉÜ„Ç≠„Çπ„Éà„ÇíË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                console.error(e);
            }
        }

        function updateAllThresholds() {
            if (historyData.length === 0) {
                return;
            }

            // Âπ≥Âùá„ÇíË®àÁÆó
            const average = {
                utouto: historyData.reduce((sum, d) => sum + d.utouto, 0) / historyData.length,
                suyasuya: historyData.reduce((sum, d) => sum + d.suyasuya, 0) / historyData.length,
                gussuri: historyData.reduce((sum, d) => sum + d.gussuri, 0) / historyData.length
            };

            // 3„Å§„ÅÆ„Çø„Ç§„Éó„Åù„Çå„Åû„Çå„Å´„Å§„ÅÑ„Å¶Ë®àÁÆó
            const thresholds = {
                utouto: calculateThreshold('utouto', average),
                suyasuya: calculateThreshold('suyasuya', average),
                gussuri: calculateThreshold('gussuri', average)
            };

            // Ë°®Á§∫„ÇíÊõ¥Êñ∞
            displayAllThresholds(thresholds, average);
        }

        function calculateThreshold(targetType, average) {
            const otherTypes = ['utouto', 'suyasuya', 'gussuri'].filter(t => t !== targetType);

            // ‰ªñ„ÅÆ„Çø„Ç§„Éó„ÅØÂπ≥Âùá„ÅÆ50%Á®ãÂ∫¶„Å´Ë®≠ÂÆö
            let thresholds = {};
            
            otherTypes.forEach(type => {
                thresholds[type] = Math.max(0, average[type] * 0.5);
            });

            // ÁõÆÊ®ô„Çø„Ç§„Éó„Å´ÊÆã„Çä„ÅÆÂÄ§„ÇíÈÖçÂàÜ
            const otherSum = otherTypes.reduce((sum, type) => sum + thresholds[type], 0);
            thresholds[targetType] = Math.max(1, 100 - otherSum);

            // ÂõõÊç®‰∫îÂÖ•„Åó„Å¶Êï¥Êï∞„Å´„Åó„Å§„Å§„ÄÅÂêàË®à„Åå100%„Å´„Å™„Çã„Çà„ÅÜ„Å´Ë™øÊï¥
            let roundedThresholds = {};
            let roundedTotal = 0;
            let typeList = ['utouto', 'suyasuya', 'gussuri'];

            // ÊúÄÂàù„Å´ÂÖ®„Å¶ÂõõÊç®‰∫îÂÖ•
            typeList.forEach(type => {
                roundedThresholds[type] = Math.round(thresholds[type]);
                roundedTotal += roundedThresholds[type];
            });

            // ÂêàË®à„Åå100%„Å´„Å™„Çã„Çà„ÅÜ„Å´Ë™øÊï¥
            let diff = 100 - roundedTotal;
            if (diff !== 0) {
                roundedThresholds[targetType] += diff;
            }

            return roundedThresholds;
        }

        function displayAllThresholds(allThresholds, average) {
            const targetTypes = ['utouto', 'suyasuya', 'gussuri'];

            // ÂêÑÁõÆÊ®ô„Çø„Ç§„Éó„ÅÆÈñæÂÄ§„ÇíË°®Á§∫
            targetTypes.forEach(targetType => {
                const thresholds = allThresholds[targetType];
                const minPercent = thresholds[targetType];
                const currentAvg = Math.round(average[targetType]);
                const timeData = percentToTime(minPercent);

                const html = `
                    <div class="time-display">
                        <div class="time-unit-group">
                            <div class="time-number">${timeData.h}</div>
                            <div class="time-unit">ÊôÇÈñì</div>
                        </div>
                        <div class="time-unit-group">
                            <div class="time-number">${timeData.m}</div>
                            <div class="time-unit">ÂàÜ</div>
                        </div>
                        <div class="time-above">‰ª•‰∏ä</div>
                    </div>
                    <div class="threshold-percent-small">${minPercent}%</div>
                    <div class="threshold-avg-text">Âπ≥Âùá: ${currentAvg}%</div>
                `;

                document.getElementById(`display${targetType.charAt(0).toUpperCase() + targetType.slice(1)}`).innerHTML = html;
            });
        }

        function saveHistoryToStorage() {
            localStorage.setItem('pokemonSleepHistory', JSON.stringify(historyData));
        }

        function loadHistoryFromStorage() {
            const stored = localStorage.getItem('pokemonSleepHistory');
            if (stored) {
                try {
                    historyData = JSON.parse(stored);
                } catch (e) {
                    console.error('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', e);
                }
            }
        }

        // adjustHistoryGridWidth„ÅÆ„É™„Çπ„Éä„Éº„ÅØ‰∏çË¶Å„Å´„Å™„Å£„Åü„ÅÆ„ÅßÂâäÈô§

    </script>
</body>
</html>
